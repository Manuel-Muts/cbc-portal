<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCHOOL ADMIN</title>
<link rel="stylesheet" href="css/admin.css">
</head>
<body>

<main class="admin-wrap">

  <header class="dashboard-header">
  <div id="schoolNameDisplay" class="school-header"></div>

    <div class="toolbar">
      <button id="logoutBtn" class="danger">Logout</button>
      <button id="refreshBtn" class="refresh-btn">ðŸ”„ Refresh Data</button>
    </div>
  </header>

  <!-- ================== REGISTER USER ================== -->
<section class="allocation-section">

  <!-- COLLAPSIBLE USERS PANEL -->
  <div id="usersPanel" class="collapsible-panel">

    <div class="panel-header">
      <h3>REGISTER NEW USER</h3>
      <button id="toggleUsersBtn" class="collapse-btn">â–¼</button>
    </div>

    <div id="usersContent" class="panel-content">

      <form id="registerForm">

        <div class="form-flex-row">
          <div>
            <label for="userRole">Role:</label>
            <select id="userRole" required>
              <option value="">-- Select Role --</option>
              <option value="student">Student</option>
              <option value="teacher">Teacher</option>
              <option value="accounts">Accounts</option>
            </select>
          </div>

          <div>
            <label for="userName">Full Name:</label>
            <input type="text" id="userName" placeholder="Emmanuel Gitonga" required>
          </div>
        </div>

        <div class="form-flex-row">
          <div>
            <label for="userEmail">Email (Teachers&Accounts):</label>
            <input type="email" id="userEmail" placeholder="teacher@example.com">
          </div>

          <div>
            <label for="userAdmission">Admission/ID (students only):</label>
            <input type="text" id="userAdmission" placeholder="S1234">
          </div>
        </div>
      <div class="form-flex-row" id="studentGradeGroup" style="display:none;">
        <div>
          <label for="studentGrade">Grade</label>
          <select id="studentGrade" name="studentGrade" >
            <option value="">Select grade</option>
            <option value="1">Grade 1</option>
            <option value="2">Grade 2</option>
            <option value="3">Grade 3</option>
            <option value="4">Grade 4</option>
            <option value="5">Grade 5</option>
            <option value="6">Grade 6</option>
            <option value="7">Grade 7</option>
            <option value="8">Grade 8</option>
            <option value="9">Grade 9</option>
            <option value="10">Grade 10</option>
            <option value="11">Grade 11</option>
            <option value="12">Grade 12</option>
          </select>
        </div>
        <div>
          <label for="studentStream">Stream (Optional):</label>
          <input type="text" id="studentStream" name="studentStream" placeholder="e.g., W, E, A" maxlength="2">
          <small>Leave empty for no stream</small>
        </div>
      </div>

        <div class="button-row">
          <button type="submit" class="primary">Register User</button>
        </div>
      </form>

      <div id="registerFeedback" class="feedback" style="display:none;"></div>

      <input type="text" id="userSearchInput" class="search-input" placeholder="Search users by name or role">

      <table id="usersTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Role</th>
            <th>Email/Admission</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <button id="exportUsersBtn" class="export-btn">Export Users to PDF</button>

    </div> <!-- end content -->

  </div> <!-- end panel -->

</section>

  <!-- ================== SUBJECT ALLOCATION ================== -->
  <section class="allocation-section">
    <h3>ALLOCATE SUBJECTS TO TEACHER</h3>

    <form id="subjectAllocForm">

      <div class="form-flex-row">
        <div>
          <label for="teacherSelect">Select Teacher:</label>
          <select id="teacherSelect" required></select>
        </div>

        <div>
          <label for="gradeRange">Select Grade Range:</label>
          <select id="gradeRange" required>
            <option value="">-- Select Range --</option>
            <option value="1-3">Grades 1-3</option>
            <option value="4-6">Grades 4-6</option>
            <option value="7-9">Grades 7-9</option>
            <option value="10-12">Grades 10-12</option>
          </select>
        </div>
      </div>

      <label for="gradesSelect">Select Grades:</label>
      <div class="multi-select-wrapper">
        <select id="gradesSelect" multiple required></select>
      </div>

      <div>
        <label for="streamInput">Stream (Optional):</label>
        <input type="text" id="streamInput" placeholder="e.g., W, E, A" maxlength="2" style="width: 100px;">
        <small>Leave empty for no stream</small>
      </div>

      <label for="subjectsSelect">Select Subjects:</label>
      <div class="multi-select-wrapper">
        <select id="subjectsSelect" multiple required></select>
      </div>

      <div class="button-row">
        <button type="submit">Save Allocation</button>
      </div>
    </form>

    <input type="text" id="subjectSearchInput" class="search-input" placeholder="Search subjects or teacher name">

    <table id="subjectAllocTable">
      <thead>
        <tr>
          <th>Teacher</th>
          <th>Grade & Stream</th>
          <th>Subjects</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button id="exportSubjectsBtn" class="export-btn">Export Subjects to PDF</button>
  </section>

  <!-- ================== CLASS TEACHER ASSIGNMENT ================== -->
  <section class="allocation-section">
    <h3>ASSIGN CLASS TEACHER</h3>

    <form id="classAllocForm">
      <div class="form-flex-row">
        <div>
          <label for="classTeacherSelect">Select Teacher:</label>
          <select id="classTeacherSelect" required></select>
        </div>

        <div>
          <label for="classGradeSelect">Assign to Grade:</label>
          <select id="classGradeSelect" required>
            <option value="">-- Select Grade --</option>
            <option value="1">Grade 1</option>
            <option value="2">Grade 2</option>
            <option value="3">Grade 3</option>
            <option value="4">Grade 4</option>
            <option value="5">Grade 5</option>
            <option value="6">Grade 6</option>
            <option value="7">Grade 7</option>
            <option value="8">Grade 8</option>
            <option value="9">Grade 9</option>
            <option value="10">Grade 10</option>
            <option value="11">Grade 11</option>
            <option value="12">Grade 12</option>
          </select>
        </div>

        <div>
          <label for="classStreamSelect">Stream (Optional):</label>
          <input type="text" id="classStreamSelect" placeholder="e.g., W, E, A" maxlength="2" style="width: 100px;">
          <small>Leave empty for no stream</small>
        </div>
      </div>

      <div class="button-row">
        <button type="submit">Save Class Teacher</button>
      </div>
    </form>

    <input type="text" id="classSearchInput" class="search-input" placeholder="Search class teacher or grade">

    <table id="classAllocTable">
      <thead>
        <tr>
          <th>Teacher</th>
          <th>Grade & Stream</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button id="exportClassBtn" class="export-btn">Export Class Teachers to PDF</button>
  </section>

  <!-- ================== SEARCH STUDENT ================== -->
  <section class="allocation-section">
    <h3>SEARCH & VIEW STUDENT</h3>

    <div class="form-flex-row" style="margin-bottom: 20px;">
      <div style="flex: 1;">
        <label for="studentSearchInput">Search Student:</label>
        <input
          type="text"
          id="studentSearchInput"
          class="search-input"
          placeholder="Search by name or admission"
        />
      </div>
      <div style="display: flex; align-items: flex-end;">
        <button id="studentSearchBtn" style="padding: 10px 20px; margin-left: 10px;">Search</button>
      </div>
    </div>

    <table id="studentSearchTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Admission</th>
          <th>Academic Year</th>
          <th>Grade & Stream</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="studentSearchBody"></tbody>
    </table>
  </section>

  <!-- ================== STUDENT PROMOTION ================== -->
  <section class="allocation-section">
    <h3>STUDENT PROMOTION</h3>

    <div class="form-flex-row">
      <div>
        <label for="fromAcademicYear">From Academic Year:</label>
        <input type="number" id="fromAcademicYear" placeholder="2025">
      </div>

      <div>
        <label for="toAcademicYear">To Academic Year:</label>
        <input type="number" id="toAcademicYear" placeholder="2026">
      </div>

      <div style="display: flex; align-items: flex-end;">
        <button id="previewPromotionBtn">Preview Promotion</button>
      </div>
    </div>

    <table id="promotionPreviewTable">
      <thead>
        <tr>
          <th>Student</th>
          <th>Admission</th>
          <th>Current Grade</th>
          <th>Next Grade</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="button-row">
      <button id="confirmPromotionBtn" class="danger" disabled>
        âœ“ Confirm Promotion
      </button>
    </div>
  </section>


</main>
<!--garde selection script for students in admin students registration-->
<script>
const userRoleSelect = document.getElementById("userRole");
const studentGradeGroup = document.getElementById("studentGrade");
const studentGradeWrapper = document.getElementById("studentGradeGroup");

userRoleSelect?.addEventListener("change", () => {
  const role = userRoleSelect.value;

  if (role === "student") {
    studentGradeWrapper.style.display = "block";
    studentGradeGroup.required = true;
  } else {
    studentGradeWrapper.style.display = "none";
    studentGradeGroup.required = false;
    studentGradeGroup.value = ""; // ðŸ”¥ VERY IMPORTANT
  }
});
</script>

<!-- SEARCH PROMOTION PREVIEW SCRIPT -->
<script src="http://localhost:5000/js/email.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<script src="js/admin.js"></script>

</body>
</html>
