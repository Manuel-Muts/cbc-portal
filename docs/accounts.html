<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Accounts</title>
  <link rel="stylesheet" href="css/accounts.css" />
</head>
<body>

  <!-- TOP BAR -->
  <header class="topbar">
    <h2>Accounts Management</h2>
    <div style="display: flex; gap: 15px; align-items: center;">
      <button id="refreshBtn" class="refresh-btn">Refresh Data</button>
      <button id="logoutBtn" class="danger">Logout</button>
    </div>
  </header>

  <main class="container">

    <!-- WELCOME HEADER -->
    <div class="welcome-header">
      <h1>Welcome to Student Portal Accounts</h1>
      <p>Manage student fees, payments, and financial records with ease</p>
    </div>

    <!-- ===============================
         SUMMARY CARDS
    =============================== -->
    <section class="stats-grid">
      <div class="stat-card expected">
        <h4>Total Expected</h4>
        <p id="totalExpected">KES 0</p>
      </div>

      <div class="stat-card paid">
        <h4>Total Paid</h4>
        <p id="totalPaid">KES 0</p>
      </div>

      <div class="stat-card balance">
        <h4>Outstanding Balance</h4>
        <p id="totalBalance">KES 0</p>
      </div>
    </section>

    <!-- POSTED FEES -->
    <section class="filters" style="margin-top:10px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h4>Posted Fee Structures</h4>
        <button id="downloadFeeStructuresPDF" class="action-btn" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); display: flex; align-items: center; gap: 8px;">
          <span>ğŸ“„</span>
          Download PDF
        </button>
      </div>
      <div class="table-wrap">
        <table id="feeStructuresTable">
          <thead>
            <tr>
              <th>Grade</th>
              <th>Academic Year</th>
              <th>Term 1 Fee</th>
              <th>Term 2 Fee</th>
              <th>Term 3 Fee</th>
              <th>Total Fee</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="feeStructuresTableBody">
            <tr>
              <td colspan="7" style="text-align: center; color: #666;">No fee structures posted yet.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- CLASS SUMMARY -->
    <section class="stats-grid" id="classSummaryGrid">
      <!-- JS injects per-class summaries -->
    </section>

    <!-- ===============================
         FILTERS + REPORTS
    =============================== -->
    <section class="filters">
      <div style="display: flex; align-items: center; gap: 8px; min-width: 180px;">
        <span style="font-size: 16px;">ğŸ“š</span>
        <select id="classFilter">
          <option value="">All Classes</option>
          <option>Grade 1</option>
          <option>Grade 2</option>
          <option>Grade 3</option>
          <option>Grade 4</option>
          <option>Grade 5</option>
          <option>Grade 6</option>
          <option>Grade 7</option>
          <option>Grade 8</option>
          <option>Grade 9</option>
          <option>Grade 10</option>
          <option>Grade 11</option>
          <option>Grade 12</option>
        </select>
      </div>

      <div style="display: flex; align-items: center; gap: 8px; min-width: 180px;">
        <span style="font-size: 16px;">ğŸ“…</span>
        <select id="termFilter">
          <option value="">All Terms</option>
          <option>Term 1</option>
          <option>Term 2</option>
          <option>Term 3</option>
        </select>
      </div>

      <div style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 250px;">
        <span style="font-size: 16px;">ğŸ”</span>
        <input
          type="text"
          id="searchInput"
          placeholder="Search student name..."
        />
      </div>

       <button class="action-btn pay-btn" onclick="downloadReport('pdf')" style="display: flex; align-items: center; gap: 8px;">
        <span>ğŸ“„</span>
        Download PDF
      </button>

      <button id="openPostFeeBtn" class="action-btn" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); display: flex; align-items: center; gap: 8px;">
        <span>â•</span>
        Post Fee Structure
      </button>
    </section>

    <!-- ===============================
         ACCOUNTS TABLE
    =============================== -->
    <section class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Class</th>
            <th colspan="3" style="text-align: center; background: #f0f8ff;">Term 1</th>
            <th colspan="3" style="text-align: center; background: #f0fff0;">Term 2</th>
            <th colspan="3" style="text-align: center; background: #fff8f0;">Term 3</th>
            <th colspan="3" style="text-align: center; background: #f8f0ff; font-weight: bold;">Total</th>
            <th>Actions</th>
          </tr>
          <tr style="background: #f9f9f9; font-size: 12px;">
            <th></th>
            <th></th>
            <th>Fee</th>
            <th>Paid</th>
            <th>Balance</th>
            <th>Fee</th>
            <th>Paid</th>
            <th>Balance</th>
            <th>Fee</th>
            <th>Paid</th>
            <th>Balance</th>
            <th>Fee</th>
            <th>Paid</th>
            <th>Balance</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="accountsTableBody">
          <!-- JS injects rows -->
        </tbody>
      </table>
    </section>

    <!-- ===============================
         CHART
    =============================== -->
    <section class="table-wrap" style="margin-top:20px;">
      <canvas id="feesChart" height="120"></canvas>
    </section>

    <!-- ===============================
         OUTSTANDING FEES REPORT
    =============================== -->
    <section class="filters" style="margin-top:30px;">
      <h4>Outstanding Fees Report</h4>
      <div style="display: flex; align-items: center; gap: 8px; min-width: 180px;">
        <span style="font-size: 16px;">ğŸ“š</span>
        <select id="outstandingClassFilter">
          <option value="">All Classes</option>
          <option>Grade 1</option>
          <option>Grade 2</option>
          <option>Grade 3</option>
          <option>Grade 4</option>
          <option>Grade 5</option>
          <option>Grade 6</option>
          <option>Grade 7</option>
          <option>Grade 8</option>
          <option>Grade 9</option>
          <option>Grade 10</option>
          <option>Grade 11</option>
          <option>Grade 12</option>
        </select>
      </div>

      <div style="display: flex; align-items: center; gap: 8px; min-width: 180px;">
        <span style="font-size: 16px;">ğŸ“…</span>
        <select id="outstandingTermFilter">
          <option value="">All Terms</option>
          <option>Term 1</option>
          <option>Term 2</option>
          <option>Term 3</option>
        </select>
      </div>

      <div style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 250px;">
        <span style="font-size: 16px;">ğŸ”</span>
        <input
          type="text"
          id="outstandingSearchInput"
          placeholder="Search student name..."
        />
      </div>

      <button id="downloadOutstandingPDF" class="action-btn" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); display: flex; align-items: center; gap: 8px;">
        <span>ğŸ“„</span>
        Download PDF
      </button>
    </section>

    <section class="table-wrap">
      <table id="outstandingFeesTable">
        <thead>
          <tr>
            <th rowspan="2">Admission</th>
            <th rowspan="2">Student Name</th>
            <th rowspan="2">Class</th>
            <th colspan="3" style="text-align: center; background: #f0f8ff;">Term 1</th>
            <th colspan="3" style="text-align: center; background: #f0fff0;">Term 2</th>
            <th colspan="3" style="text-align: center; background: #fff8f0;">Term 3</th>
            <th colspan="3" style="text-align: center; background: #f8f0ff; font-weight: bold;">Total</th>
          </tr>
          <tr style="background: #f9f9f9; font-size: 12px;">
            <th>Fee</th>
            <th>Paid</th>
            <th>Balance</th>
            <th>Fee</th>
            <th>Paid</th>
            <th>Balance</th>
            <th>Fee</th>
            <th>Paid</th>
            <th>Balance</th>
            <th>Fee</th>
            <th>Paid</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody id="outstandingFeesTableBody">
          <!-- JS injects rows -->
        </tbody>
      </table>
    </section>

  </main>

  <!-- ===============================
       PAYMENT MODAL
  =============================== -->
  <div id="paymentModal" class="modal hidden">
    <div class="modal-backdrop"></div>

    <div class="modal-content">
      <h3>Record Payment</h3>

      <p id="modalStudentName"></p>

      <input type="number" id="paymentAmount" placeholder="Amount (KES)" />
      <input type="text" id="paymentReference" placeholder="Reference (e.g. receipt no.)" />

      <select id="paymentMethod">
        <option value="cash">Cash</option>
        <option value="mpesa">Mpesa</option>
        <option value="bank">Bank</option>
        <option value="cheque">Cheque</option>
      </select>

      <select id="paymentTerm">
        <option value="">Select Term</option>
        <option>Term 1</option>
        <option>Term 2</option>
        <option>Term 3</option>
      </select>

      <div class="modal-actions">
        <button id="savePaymentBtn">Save Payment</button>
        <button class="cancel-btn" onclick="closePaymentModal()">Cancel</button>
      </div>
    </div>
  </div>

    <!-- ===============================
         POST FEE STRUCTURE MODAL
    =============================== -->
    <div id="postFeeModal" class="modal hidden">
      <div class="modal-backdrop"></div>

      <div class="modal-content">
        <h3>Post Fee Structure</h3>

        <label>Grade</label>
        <input type="text" id="feeGrade" placeholder="e.g. Grade 4" />

        <label>Academic Year</label>
        <input type="number" id="feeYear" placeholder="2026" />

        <label>Term 1 Fee (KES)</label>
        <input type="number" id="feeTerm1" placeholder="e.g. 15000" />

        <label>Term 2 Fee (KES)</label>
        <input type="number" id="feeTerm2" placeholder="e.g. 15000" />

        <label>Term 3 Fee (KES)</label>
        <input type="number" id="feeTerm3" placeholder="e.g. 20000" />

        <div class="modal-actions">
          <button id="saveFeeBtn">Save Fee Structure</button>
          <button class="cancel-btn" onclick="document.getElementById('postFeeModal').classList.add('hidden')">Cancel</button>
        </div>
      </div>
    </div>

  <!-- ===============================
       LEDGER MODAL
  =============================== -->
  <div id="ledgerModal" class="modal hidden">
    <div class="modal-backdrop"></div>

    <div class="modal-content">
      <h3>Student Payment Ledger</h3>

      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Amount</th>
            <th>Method</th>
            <th>Reference</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="ledgerTableBody"></tbody>
      </table>

      <div class="modal-actions">
        <button class="cancel-btn" onclick="closeLedgerModal()">Close</button>
      </div>
    </div>
  </div>

  <script src="js/accounts.js"></script>
</body>
</html>
